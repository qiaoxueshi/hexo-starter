{"compress":true,"commitItems":[["af2c7d6d-7b5f-48ff-9ccf-1efda6b4109f",1501143072395,"---\ntitle: æ­å¼€ Monad çš„ç¥ç§˜é¢çº±\ndate: 2016-04-24 03:29:09\ntags: [iOS, Monad]\n---\n\næˆ‘ä»¬çŸ¥é“ Swift è¯­è¨€æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ï¼Œæ‰€ä»¥å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€äº›æ¦‚å¿µè¿‘æ¥æ¯”è¾ƒç«ã€‚æœ‰ä¸€äº›ç›¸å¯¹äºOOPæ¥è¯´ä¸å¤ªä¸€æ ·çš„æ¦‚å¿µï¼Œæ¯”å¦‚ `Applicative`, `Functor` ä»¥åŠä»Šå¤©çš„ä¸»é¢˜ `Monad`.  å¦‚æœå•çº¯çš„ä»å­—é¢ä¸Šæ¥çœ‹ï¼Œå¾ˆç¥ç§˜ï¼Œå®Œå…¨ä¸çŸ¥é“å…¶å«ä¹‰ã€‚ä¸­æ–‡ç¿»è¯‘å«åš`å•å­`ï¼Œä½†æ˜¯ç¿»è¯‘è¿‡æ¥ä¹‹åå¯¹äºè¿™ä¸ªè¯çš„ç†è§£å¹¶æ²¡æœ‰èµ·åˆ°ä»»ä½•å¸®åŠ©ã€‚\n\næˆ‘çš„ç†è§£å¾ˆç®€å•ï¼Œ`Functor`æ˜¯å®ç°äº†`map`å‡½æ•°çš„å®¹å™¨ï¼Œ`Monad` å°±æ˜¯å®ç°äº† `flatMap` æ–¹æ³•çš„å®¹å™¨ï¼Œæ¯”å¦‚åœ¨Swifté‡Œï¼Œ`Optional`, `CollectionType` ç­‰ç­‰éƒ½å¯ä»¥ç§°ä¸º Monadã€‚\n\næ—¢ç„¶æœ‰äº† map, flatMap åˆæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿä¸¤è€…æœ‰ä»€ä¹ˆè”ç³»å’ŒåŒºåˆ«å‘¢ï¼Ÿ\n\n###  map vs flatMap\nmap å’Œ flatMap çš„å…±åŒç‚¹éƒ½æ˜¯æ¥å—ä¸€ä¸ªtransformå‡½æ•°ï¼ŒæŠŠä¸€ä¸ªå®¹å™¨è½¬æ¢ä¸ºå¦å¤–ä¸€ä¸ªå®¹å™¨ã€‚\n\nä¸‹é¢ä¸»è¦ä»`ç»´åº¦`è¿™ä¸€å—æ¥è§£é‡Šä¸¤è€…çš„åŒºåˆ«ï¼Œæˆ‘ä»¬å…ˆæ¥ç®€å•çš„å®šä¹‰ä¸€ä¸‹`ç»´åº¦`ï¼š\n> å¯¹äºç±»å‹Tï¼Œå¦‚æœç±»å‹Sæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œä¸”å…ƒç´ çš„ç±»å‹åŒ…å«Tï¼Œé‚£æˆ‘ä»¬å°±è¯´ï¼š  \nS(ç»´åº¦) = T(ç»´åº¦) ï¼‹ 1\n\nä¸¾ä¸ªğŸŒ°ï¼Œ [Int] (ç»´åº¦) = Int (ç»´åº¦) +1, Int? (ç»´åº¦) = Int(ç»´åº¦) + 1.\n\nmap å’Œ flatMapçš„åŒºåˆ«æ˜¯ï¼Œå¯¹äºmapï¼Œå®¹å™¨é‡Œçš„ä¸€ä¸ªå…ƒç´ ç»è¿‡transformååªäº§ç”Ÿä¸€ä¸ªå…ƒç´ ï¼Œæ˜¯ one-to-oneçš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ç»è¿‡è½¬æ¢åï¼Œçº¬åº¦æ˜¯ä¸å˜çš„ã€‚æ¯”å¦‚:\n\n```Swift\nvar intArray: [Int] = [1, 2, 3, 4, 5]\nvar stringArray: [Int] = intArray.map { (value: Int) -> String in\n    return \"\\(value)\"\n}\n//stringArray: [\"1\", \"2\", \"3\", \"4\", \"5\"]\n```\nè¿™ä¸ª transform å‡½æ•°çš„æ˜¯ `Int -> Int` çš„ï¼Œä¸¤è¾¹çš„ç»´åº¦æ˜¯ä¸€è‡´çš„ã€‚\n\nå¯¹äºflatmapï¼Œå®¹å™¨é‡Œçš„ä¸€ä¸ªå…ƒç´ ç»è¿‡transformå¯èƒ½è½¬æ¢æˆ 0ä¸ªï¼Œ1ä¸ª æˆ–è€…å¤šä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ one-to-any çš„å…³ç³»ï¼Œæ—¢ç„¶æ˜¯ any çš„å…³ç³»ï¼Œå°±éœ€è¦ä¸€ä¸ªå®¹å™¨æ¥å­˜æ”¾anyä¸ªå…ƒç´ ï¼Œæ‰€ä»¥ç»è¿‡transformçš„è¿”å›å€¼é€šå¸¸æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œæ‰€ä»¥ transform å‡½æ•°æ‰§è¡Œä¹‹åï¼Œç›¸å½“äºç»´åº¦ï¼‹1ã€‚\n\n```Swift\nvar oddIntArray: [Int] = intArray.flatMap { (value: Int) -> Int? in\n    return value % 2 == 1 ? value : nil\n}\n//oddIntArray: [1, 3, 5]\n```\nè¿™é‡Œçš„ transform æ˜¯ `Int -> Int?` çš„ï¼Œæˆ‘ä»¬çŸ¥é“ Int? æ˜¯ Int çš„åŒ…è£…ç±»å‹ï¼Œæ‰€ä»¥è¯´ transform ç›¸å½“äºå¯¹æ¯ä¸ªå…ƒç´ éƒ½åŒ…äº†ä¸€å±‚ï¼Œæå‡äº†ä¸€ä¸ªç»´åº¦.\n\nä½†æ˜¯æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šé¢ä¾‹å­é‡ŒstringArrayå’ŒoddIntArrayçš„ç±»å‹ï¼Œéƒ½æ˜¯[Int]ï¼Œä¹Ÿå°±æ˜¯è¯´flatMapå‡½æ•°å¯¹ transformå‡½æ•°çš„è¿”å›å€¼åšäº†é™ç»´å¤„ç†ã€‚é‚£ä¹ˆflatçš„æ„æ€åœ¨è¿™é‡Œä¹Ÿå°±çŸ¥é“äº†ï¼Œå°±æ˜¯æŠŠtransform è¿”å›çš„å®¹å™¨`é™ç»´æ”»å‡»`(æ‹æ‰)ï¼Œæ‹¿å‡ºé‡Œé¢çš„å…ƒç´ ã€‚\n\nflatMap å‡½æ•°ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿåœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šå¯¹ä¸€ä¸ªå€¼/æ“ä½œè¿›è¡Œé“¾å¼æ“ä½œï¼Œä¸ºäº†ä¿è¯åé¢è¿˜å¯ä»¥ç»§ç»­æ–¹ä¾¿çš„è¿›è¡Œé“¾å¼æ“ä½œï¼Œä¸€èˆ¬éœ€è¦ä¿æŒç»´åº¦ä¸å˜ã€‚å…¶å®å¯ä»¥çœ‹ä½œä¸€ä¸ªçº¦å®šï¼Œå¤§å®¶éƒ½éµå¾ªä¸€å®šçš„è§„åˆ™ï¼Œæ‰éƒ½æœ‰å¾—ç©ã€‚\n\n### å¦‚ä½•ç¡®å®šä½¿ç”¨ map or flatMap çš„æ—¶æœºï¼Ÿ\nä»ä¸Šé¢å¯ä»¥çœ‹åˆ° map å¯¹ transform çš„è¿”å›å€¼æ²¡æœ‰åšç‰¹æ®Šçš„å¤„ç†ï¼ŒflatMapå¯¹äºtransformçš„è¿”å›å€¼ä¼šåšé™ç»´å¤„ç†ï¼Œæ¯”å¦‚ unwrap optional å€¼ç­‰ã€‚\n\nå…¶å®å¯ä»¥åæ¨ï¼Œå¦‚æœç»™å®šçš„transformå‡½æ•°ä¼šå¯¹è°ƒç”¨è€…å®¹å™¨é‡Œçš„æ¯ä¸ªå…ƒç´ åšå‡ç»´ï¼Œé‚£æˆ‘ä»¬éœ€è¦ç”¨ flatMap å¯¹å®ƒçš„ç»“æœè¿›è¡Œé™ç»´ï¼Œæ¥ä¿è¯è°ƒç”¨flatMapå‰åç»´åº¦ä¿æŒä¸€è‡´ã€‚å¦‚æœè¯´transformè°ƒç”¨å‰åç»´åº¦æ²¡æœ‰å˜åŒ–ï¼Œä½¿ç”¨mapæ–¹æ³•å°±è¡Œäº†ã€‚\n\n### Swift ä¸­çš„ map å’Œ flatMap æ–¹æ³•\né¦–å…ˆçœ‹çœ‹ Optional<Wrapped> çš„ map å’Œ flatMap æ–¹æ³•ï¼š\n\n```Swift\n    /// If `self == nil`, returns `nil`.  Otherwise, returns `f(self!)`.\n    @warn_unused_result\n    public func map<U>(@noescape f: (Wrapped) throws -> U) rethrows -> U?\n    /// Returns `nil` if `self` is `nil`, `f(self!)` otherwise.\n    @warn_unused_result\n    public func flatMap<U>(@noescape f: (Wrapped) throws -> U?) rethrows -> U?\n```\n\nmap çš„ transform æ˜¯ `Wrapped -> U` ç»´åº¦ä¸å˜, flatMap çš„ transform æ–¹æ³•æ˜¯ `Wrapped -> U?`ï¼Œç»´åº¦+1ã€‚å› ä¸º Optional çš„ç‰¹æ®Šæ€§ï¼ŒflatMap æä¾›äº† one-to-zero/one çš„å…³ç³»ã€‚\n\nç»§ç»­çœ‹çœ‹ CollectionTypeï¼š\n\n```\n    public func map<T>(@noescape transform: (Self.Generator.Element) throws -> T) rethrows -> [T]\n\n    public func flatMap<T>(@noescape transform: (Self.Generator.Element) throws -> T?) rethrows -> [T]\n\n    public func flatMap<S : SequenceType>(transform: (Self.Generator.Element) throws -> S) rethrows -> [S.Generator.Element]\n```\næœ‰ä¸€ä¸ªmapå‡½æ•°å’Œä¸¤ä¸ªflatMap, map çš„ transform å‡½æ•°æ˜¯ `Element -> T` ç»´åº¦ä¸å˜ï¼Œä¸¤ä¸ª flatMap çš„ transform å‡½æ•°åˆ†åˆ«æ˜¯ `Element -> T? `(one-to-zero/one) å’Œ `Element -> S: SequenceType`, SequenceType æ˜¯ä¸ªé›†åˆï¼Œç›¸å½“äº one-to-anyï¼Œè¿™ä¸¤ä¸ªtransformç»´åº¦éƒ½å‡äº†ä¸€çº§ã€‚\n\n> ç‰¹åˆ«æ„Ÿè°¢æˆ‘çš„åŒäº‹ [ç‹è½²](http://weibo.com/u/2010406980), æœ¬æ–‡çš„å¾ˆå¤šæ€è·¯éƒ½å¾—ç›Šäºå’Œä»–çš„è®¨è®ºã€‚\n\n\n",[[1501143067039,["qiaoxueshi@bogon",[[1,447," "]],[447,447],[448,448]]],[1501143069073,["qiaoxueshi@bogon",[[1,457," "]],[457,457],[458,458]]]]]]}